FROM node:fermium-slim

RUN apt update
COPY ./ ./
RUN npm install

ARG RABBITMQ_ENDPOINT
ARG DOWNLOAD_REQUEST_EXCHANGE
ARG DOWNLOAD_REQUEST_SOUNDCLOUD_QUEUE
ARG DOWNLOAD_COMPLETED_EXCHANGE
ARG MINIO_INTERNAL_ENDPOINT
ARG MINIO_INTERNAL_USER
ARG MINIO_INTERNAL_PASS
ARG MINIO_INTERNAL_BUCKET
ARG SOUNDCLOUD_CLIENT_ID

ENV RABBITMQ_ENDPOINT=${RABBITMQ_ENDPOINT}
ENV DOWNLOAD_REQUEST_EXCHANGE=${DOWNLOAD_REQUEST_EXCHANGE}
ENV DOWNLOAD_REQUEST_SOUNDCLOUD_QUEUE=${DOWNLOAD_REQUEST_SOUNDCLOUD_QUEUE}
ENV DOWNLOAD_COMPLETED_EXCHANGE=${DOWNLOAD_COMPLETED_EXCHANGE}
ENV MINIO_INTERNAL_ENDPOINT=${MINIO_INTERNAL_ENDPOINT}
ENV MINIO_INTERNAL_USER=${MINIO_INTERNAL_USER}
ENV MINIO_INTERNAL_PASS=${MINIO_INTERNAL_PASS}
ENV MINIO_INTERNAL_BUCKET=${MINIO_INTERNAL_BUCKET}
ENV SOUNDCLOUD_CLIENT_ID=${SOUNDCLOUD_CLIENT_ID}

ENTRYPOINT [ "npm", "test"]